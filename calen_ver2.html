<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta http-equiv="content-script-type" content="text/javascript">
<title>シェアカレ MyCalendar</title>
<link href="share_ver2.css" rel="stylesheet" type="text/css">
<link href="css/bootstrap.min.css" rel="stylesheet">
<script type="text/javascript" src="jquery-3.1.1.min.js"></script>
<script src="bootjs/bootstrap.min.js"></script>
<script type="text/javascript">

// 祝日1：何月の何日か？
        var Holidays1 = new Array(1,1, 2,11, 3,21, 4,29, 5,3, 5,4, 5,5, 8,11, 9,22, 11,3, 11,23, 12,23);
        // 祝日2：何月の第何月曜日か？
        var Holidays2 = new Array(1,2, 7,3, 9,3, 10,2);
        // グループフラグ
        var Gflag = 0;
        // 現在の年、月、日の取得
        var now       = new Date();
        var thisYear  = now.getFullYear();
        var thisMonth = now.getMonth() + 1;
        var today     = now.getDate();
        
        // 表示年月の記憶
        var year      = thisYear;
        var month     = thisMonth;
        
        var monthdays = new Array(31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31);
        var days = new Array("日", "月", "火", "水", "木", "金", "土");
        var todotitle;
        var todocateg;
        var todomsg;
        
        function showCalen(n){
        month += n;
       
        if (month == 0) { year--; month=12; }
        else if (month == 13) { year++; month=1; }
        var flag = ((year == thisYear) && (month == thisMonth))? 1: 0;
        
        var date = new Date(year, month-1, 1);
        var startDay = date.getDay();
        
        var dateMax = monthdays[month - 1];
        if (month == 2 && ((year%4 == 0 && year%100 != 0) || year%400 == 0)) dateMax = 29;
        
        // 休日配列の初期化
        var holidays = new Array();
        for (var i=0; i<=dateMax; i++) holidays[i] = 0;
        
        // 祝日1 の処理
        var firstSunday = (startDay == 0)? 1: 8 - startDay;
        for (i=0; i<Holidays1.length; i+=2) {
        if (Holidays1[i] == month) {
        holidays[Holidays1[i+1]] = 1;
        for (var j=firstSunday; j<dateMax; j+=7)
        if (Holidays1[i+1] == j) holidays[j+1] = 1;  // 振替休日
        }
        }
        // 祝日2 の処理
        var mondays = new Array();
        var firstMonday = (startDay < 2)? 2 - startDay: 9 - startDay;
        for (i=0; i<Holidays2.length; i+=2)
        if (Holidays2[i] == month) holidays[(Holidays2[i+1] - 1) * 7 + firstMonday] = 1;
        
        var htmlStr = "<table class='calen'>\n"
        + "<tr class='bg1'><th colspan=7>" +"<input type='button' value='<<' id='back' onclick='restart(-1)'>" + year + "年 " + month + "月" + "<input type='button' value='>>' id='next' onclick='restart(1)'>" + "</th></tr>\n";
        htmlStr +="<tr class='bg2'><th class='sun'>" + days[0] + "</th>";
        for (i=1; i<6; i++) htmlStr += "<th>" + days[i] + "</th>";
        htmlStr += "<th class='sat'>" + days[6] + "</th></tr>\n";
        
        var col=0;
        if (startDay > 0) {
        htmlStr += "<tr class='daydate'>";
        for ( ; col<startDay; col++) htmlStr += "<td>&nbsp;</td>";
        }
        for (i=1; i<=dateMax; i++) {
        if (col == 0) htmlStr += "<tr class='daydate'>";
        if (flag == 1 && i == today) {
        if (holidays[i] == 1 || col == 0) htmlStr += "<td class='today sun' yy='"+year+"' mm='"+month+"' day='"+i+"' onclick='test(this);return false;'>";
        else if (col == 6) htmlStr += "<td class='today sat' yy='"+year+"' mm='"+month+"' day='"+i+"' onclick='test(this);return false;'>";
        else htmlStr += "<td class='today' yy='"+year+"' mm='"+month+"' day='"+i+"' onclick='test(this);return false;'>";
        }
        else if (holidays[i] == 1 || col == 0) htmlStr += "<td class='sund' yy='"+year+"' mm='"+month+"' day='"+i+"' onclick='test(this);return false;'>";
        else if (col == 6) htmlStr += "<td class='satd' yy='"+year+"' mm='"+month+"' day='"+i+"' onclick='test(this);return false;'>";
        else htmlStr += "<td class='normal' yy='"+year+"' mm='"+month+"' day='"+i+"' onclick='test(this);return false;'>";
        if (i == 25){
            htmlStr += i +"<h6>" + "100件予定あり" + "</h6>" ;
        }
        else{
            htmlStr += i +"<h6>" + "&nbsp;" + "</h6>";
        }
        htmlStr += "</td>";
        if (col == 6) { htmlStr += "</tr>\n"; col=0; } else col++;
        }
        if (col != 0) {
        for ( ; col<7; col++) htmlStr += "<td>&nbsp;</td>";
        htmlStr += "</tr>";
        }
        htmlStr += "</table>";
         document.getElementById("Group_calen").innerHTML = htmlStr;
        if(Gflag != 1){
           document.getElementById("calen").innerHTML = htmlStr;
        }
        else{
         document.getElementById("Group_calen").innerHTML = htmlStr;
        }
        //入力画面生成
        var textinput = '<div class="textinputs">' + '<div>' + '<div id="calendate">' + '</div>' + '<label for="settitle">' + "タイトル" +'</label>' + '<input type="text" id="settitle">' + '</div>';    //タイトル入力
        textinput += '<div>' + '<label for="categ">' + "カテゴリー" + '</label>' + '<input type="text" id="categ">' + '</div>';        //カテゴリー
        textinput += '<div>' + '<label for="msg">' + "メッセージ" + '</label>' + '<textarea id="msg">' + '</textarea>' + '</div>';       //メッセージ
        textinput += '<div class="button">' + '<input type="button" value="send" onclick="settodo(settitle.value,categ.value,msg.value)">' + '</div>';
        textinput += '</div>';
        document.getElementById("inputmenu").innerHTML = textinput;
        //入力画面生成２
        var textinput2 = '<div class="textinputs">' + '<div>' + '<div id="calendate2">' + '</div>' + '<label for="settitle2">' + "タイトル" +'</label>' + '<input type="text" id="settitle2">' + '</div>';    //タイトル入力
        textinput2 += '<div>' + '<label for="categ2">' + "カテゴリー" + '</label>' + '<input type="text" id="categ2">' + '</div>';        //カテゴリー
        textinput2 += '<div>' + '<label for="msg2">' + "メッセージ" + '</label>' + '<textarea id="msg2">' + '</textarea>' + '</div>';       //メッセージ
        textinput2 += '<div class="button">' + '<input type="button" value="send" onclick="settodo(settitle2.value,categ2.value,msg2.value)">' + '</div>';
        textinput2 += '</div>';
        
        document.getElementById("inputmenu2").innerHTML = textinput2;
        }
        
        //日付クリック時の処理
        function test(e){                                     
        var openset = '<div id="tw1" onclick="showopen()">' + '<div class="tw">' + "＋" + '<div>' + '</div>';
            //日付情報の取得
            var yy = e.getAttribute('yy');
            var mm = e.getAttribute('mm');
            var day = e.getAttribute('day');
            $('.textinputs #calendate').text( yy + '/' + mm + '/' + day);
            $('.textinputs #calendate2').text( yy + '/' + mm + '/' + day);
            //入力画面の表示、非表示の関数呼び出しのクリックイベント
        /*-----データベースの処理---------------*/
            // todo:予定があれば表示

        if(Gflag != 1){
            document.getElementById("tw2").innerHTML = openset;
        }
        else{
            document.getElementById("tw3").innerHTML = openset;
        }
        }
        
        function settodo(title, ctegory, message){
            $(function(){              //入力したデータを変数に代入
            todotitle = title;
            todocateg = ctegory;
            todomsg = message;
            // データベースの処理で入力情報を格納

            $('.tw').text("＋");
            if(Gflag != 1){ //プライベート予定追加
            $('#open').css('display' , 'none');
            $('.todolist').css('display' ,'block')
            $('tbody' , '.todolist').append($('<tr class="active"></tr>')
            .append($('<td class="tit" onclick="showtodo()"></td>').text(title))
            .append($('<td class="ac1"></td>').append('<button type="button" class="btn btn-danger delete"> Delete</button>'))
            .append($('<td class="ac2"></td>').append('<button type="button" class="btn btn-success" id="edit">Edit</button>'))
            );
            }
            else{   //グループ予定追加
             $('#open2').css('display' , 'none');
            $('.todolist2').css('display' ,'block')
            $('tbody' , '.todolist2').append($('<tr class="active"></tr>')
            .append($('<td class="tit" onclick="showtodo()"></td>').text(title))
            .append($('<td class="ac1"></td>').append('<button type="button" class="btn btn-danger delete"> Delete</button>'))
            .append($('<td class="ac2"></td>').append('<button type="button" class="btn btn-success" id="edit">Edit</button>'))
            );
            }

            $('#settitle').val('');
            $('#categ').val('');
            $('#msg').val('');
            });	
        }

        function restart(n){
        $('#todo').text("");
        $('#todotable' ).find("tr:gt(0)").remove();         //全行削除
        $('.todolist').css('display' , 'none');
        $('#tw2').text("");
        $('#open').css('display' , 'none')
        showCalen(n);
        }
        function showopen(){
        $(function(){ 
        if(Gflag != 1){                                   //入力画面の表示、非表示
            if($('#open').css('display') == 'none'){
                $('#open').css('display' , 'block');
                $('.tw').text("ー");
            }
            else{
                $('#open').css('display' , 'none');
                $('.tw').text("＋");
            }
        }
        else{if($('#open2').css('display') == 'none'){
                $('#open2').css('display' , 'block');
                $('.tw').text("ー");
            }
            else{
                $('#open2').css('display' , 'none');
                $('.tw').text("＋");
            }}
         } ); 
         }    
        //入力した内容を表示
        function showtodo() {
        var showtodotext =  '<div class="textinputs">' + '<div>' + '<span class= "showtext1">' + "タイトル"  + '</span>' + '<div class ="text1">' + todotitle + '</div>' + '</div>' ;          //タイトル
        showtodotext += '<div>' + '<span class ="showtext1">' + "カテゴリー" + '</span>' + '<div class="text1">' + todocateg + '</div>' + '</div>';        //カテゴリー
        showtodotext += '<div>' + '<span class ="showtext1">' + "メッセージ" + '</span>' + '<div class="text2">' + todomsg + '</div>' + '</div>';           //メッセージ
        showtodotext += '<div class="button">' + '<input type="button" value="閉じる" onclick="showopen()">' + '</div>';
        showtodotext += '</div>';
        $('#todo').html(showtodotext);
        }

    $(function(){
        //予定の削除ボタンクリック時 
        $(document).on('click' , '.delete', function(){
            if(Gflag != 1){
            var rowNum = $('#todotable .delete').index(this);
            $('#todotable').find('tr').eq(rowNum + 1).remove();
            if($('#todotable .delete').length == 0){
                $('.todolist').css('display' , 'none');
                //プライベートカレンダーの予定削除
            }
            }
            else{
                var rowNum = $('#todotable2 .delete').index(this);
            $('#todotable2').find('tr').eq(rowNum + 1).remove();
            if($('#todotable2 .delete').length == 0){
                $('.todolist2').css('display' , 'none');
                //グループカレンダーの予定削除
            }
            }
            // todo:関連する情報をデータベースから削除する
            }

        );

        $(document).on('click','.delete_Group', function(){     //グループの削除ボタンクリック時
            $(this).parent().remove();
            
            // todo:関連する情報をデータベースから削除する


        })

    $('.edit_Group').on('click',function(){        //グループID入力　スライド
  if($('.slide').hasClass('off')){
    $('.slide').removeClass('off');
    $('.slide').animate({'marginLeft':'0px'},300).addClass('on');
    $('#titleh h3').text('グループID入力');
  }else{
    $('.slide').addClass('off');
    $('.slide').animate({'marginLeft':'-300px'},300);
    $('#titleh h3').text('登録したグループ名')
  }
});
    $('.create_Group').on('click',function(){       //グループカレンダー入力
        $('#createin').css('display' , 'block');
        $('#menu_ber h1').css('display','none');
        $('#menu_ber').prepend('<input type="text" id="Group_title" placeholder="グループ名の入力(15文字以内)">');
        Gflag = 1;
    });

    $('.cancel_Group').on('click',function(){　 // グループカレンダー入力解除
        $('#createin').css('display', 'none');
        $('#Group_title').remove();
        $('#menu_ber h1').css('display', 'block');
        Gflag = 0;

    })

    });  

    

</script>
        
        
        </head>
        <body onload="showCalen(0)">
        <div id="menu_ber">
            <h1>ゲスト様のカレンダー</h1>
            <div id="logout"></div>
        </div>
        <hr>
        <!-- <p id="change"><input type="button" value="前月" onclick="showCalen(-1)"> -->
        <!-- <input type="button" value="次月" onclick="showCalen(1)"></p> -->
        <p id="calen"></p>
        <div class="todolist" style="display: none">            
        <table class="table table-bordered table-hover table-condensed" id="todotable">
         <thead class="scrollHead">
             <tr>
                <th class="tit">TITLE</th>
                <th class="ac1"> </th>
                <th class="ac2"> </th>
             </tr>
         </thead>
         <tbody class="scrollBody">
         </tbody>
         <tfoot>
         </tfoot>
        </table> 
        </div>
        <div id="todo"></div>
             
             <div class="Groupsection"> 
            <div class="GroupBox">
            <div id="titleh">
            <h3>登録したグループ名</h3>
            </div>
            <div class="slide off">
                <input type="text"><button type="button" class="btn btn-success sign">ボタン２</button>
            </div>
            <div class="Grouptext">
            <div>
                <div class="Grouplist">神戸電子専門学校　行事</div><button class="btn btn-danger btn-xs delete_Group">削除</button>
                
            </div>
            <div>
                <div class="Grouplist">アルバイトシフト</div><button class="btn btn-danger btn-xs delete_Group">削除</button>
            </div>
            <div>
                <div class="Grouplist">就活関連の予定</div><button class="btn btn-danger btn-xs delete_Group">削除</button>
            </div>
            <div>
                <div class="Grouplist">グループ開発　スケジュール</div><button class="btn btn-danger btn-xs delete_Group">削除</button>
            </div>
            <div>
                 <div class="Grouplist">なにかしらの予定</div><button class="btn btn-danger btn-xs delete_Group">削除</button>
            </div>
            <div>
                 <div class="Grouplist">なにかしらの予定</div><button class="btn btn-danger btn-xs delete_Group">削除</button>
            </div>
            <div>
                 <div class="Grouplist">なにかしらの予定</div><button class="btn btn-danger btn-xs delete_Group">削除</button>
            </div>
            <div>
                 <div class="Grouplist">なにかしらの予定</div><button class="btn btn-danger btn-xs delete_Group">削除</button>
            </div>
            <div>
                 <div class="Grouplist">なにかしらの予定</div><button class="btn btn-danger btn-xs delete_Group">削除</button>
            </div>
            <div>
                 <div class="Grouplist">なにかしらの予定</div><button class="btn btn-danger btn-xs delete_Group">削除</button>
            </div>
            <div>
                 <div class="Grouplist">なにかしらの予定</div><button class="btn btn-danger btn-xs delete_Group">削除</button>
            </div>
            <div>
                 <div class="Grouplist">なにかしらの予定</div><button class="btn btn-danger btn-xs delete_Group">削除</button>
            </div>
        </div>
        </div>
           <p id="GroupEdit"><button class="btn btn-primary edit_Group">新しいグループに参加</button> 
         <button class="btn btn-primary create_Group">グループを作る</button>
        </p>
        </div>
        <!-- 折りこみ展開ポインタ -->
        <div id="tw2"> </div>
        
        <!-- 折り畳まれ部分 -->
        <div style="display: none" id="open">
        <p id="inputmenu"></p></div>
        <div id="createin">
            <div id="Group_calen"></div>
         <div class="todolist2" style="display: none">            
        <table class="table table-bordered table-hover table-condensed" id="todotable2">
         <thead class="scrollHead">
             <tr>
                <th class="tit">TITLE</th>
                <th class="ac1"> </th>
                <th class="ac2"> </th>
             </tr>
         </thead>
         <tbody class="scrollBody">
         </tbody>
         <tfoot>
         </tfoot>
        </table> 
        </div>
         <div id="tw3"> </div>
        
        <!-- 折り畳まれ部分 -->
        <div style="display: none" id="open2">
        <p id="inputmenu2"></p></div>
        <p id="Group_create_button"><button class="btn btn-danger ok_Group">完了</button> 
         <button class="btn btn-success cancel_Group">キャンセル</button>
        </p>
        </div>
        </body>
        </html>
